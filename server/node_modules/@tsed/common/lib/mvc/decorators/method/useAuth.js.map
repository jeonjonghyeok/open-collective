{"version":3,"file":"useAuth.js","sourceRoot":"","sources":["../../../../src/mvc/decorators/method/useAuth.ts"],"names":[],"mappings":";;;AAAA,qCAUoB;AACpB,+CAAwD;AACxD,2CAAsC;AAEtC;;;;;;;;;;;;;;;;;;;GAmBG;AACH,SAAgB,OAAO,CAAC,SAAoB,EAAE,UAAwB,EAAE;IACtE,OAAO,CAAI,GAAG,IAAyB,EAAqC,EAAE;QAC5E,QAAQ,sBAAe,CAAC,IAAI,CAAC,EAAE;YAC7B,KAAK,qBAAc,CAAC,MAAM;gBACxB,OAAO,sBAAe,CACpB,cAAO,CAAC,CAAC,KAAY,EAAE,EAAE;oBACvB,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE;wBACzB,OAAO,qBAAS,CAAC,SAAS,CAAC,CAAC;qBAC7B;gBACH,CAAC,CAAC,EACF,yBAAW,CAAC,SAAS,EAAE,OAAO,CAAC,CAChC,CAAC,GAAG,IAAI,CAAC,CAAC;YAEb,KAAK,qBAAc,CAAC,KAAK;gBACvB,wBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC,CAAC;gBACxD,MAAM;YAER;gBACE,MAAM,IAAI,+BAAwB,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;SACrD;IACH,CAAC,CAAC;AACJ,CAAC;AArBD,0BAqBC","sourcesContent":["import {\n  applyDecorators,\n  decorateMethodsOf,\n  DecoratorParameters,\n  decoratorTypeOf,\n  DecoratorTypes,\n  Store,\n  StoreFn,\n  Type,\n  UnsupportedDecoratorType\n} from \"@tsed/core\";\nimport {AuthOptions, IAuthOptions} from \"./authOptions\";\nimport {UseBefore} from \"./useBefore\";\n\n/**\n * Use custom authentication strategy on your endpoint.\n *\n * ```typescript\n * @Controller('/mypath')\n * @UseAuth(MyAuthStrategy)\n * class MyCtrl {\n *\n *   @Get('/')\n *   @UseAuth(MyAuthStrategy, {role: 'admin'})\n *   public getResource(){}\n * }\n * ```\n *\n * @param guardAuth {Type<any>} A middleware which implement a custom auth strategy\n * @param options {Object} Object passed to the customer auth strategy\n * @returns {Function}\n * @decorator\n * @operation\n */\nexport function UseAuth(guardAuth: Type<any>, options: IAuthOptions = {}): Function {\n  return <T>(...args: DecoratorParameters): TypedPropertyDescriptor<T> | void => {\n    switch (decoratorTypeOf(args)) {\n      case DecoratorTypes.METHOD:\n        return applyDecorators(\n          StoreFn((store: Store) => {\n            if (!store.has(guardAuth)) {\n              return UseBefore(guardAuth);\n            }\n          }),\n          AuthOptions(guardAuth, options)\n        )(...args);\n\n      case DecoratorTypes.CLASS:\n        decorateMethodsOf(args[0], UseAuth(guardAuth, options));\n        break;\n\n      default:\n        throw new UnsupportedDecoratorType(UseAuth, args);\n    }\n  };\n}\n"]}