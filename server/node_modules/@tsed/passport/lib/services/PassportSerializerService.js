"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PassportSerializerService = void 0;
const tslib_1 = require("tslib");
const common_1 = require("@tsed/common");
const core_1 = require("@tsed/core");
const di_1 = require("@tsed/di");
const UserInfo_1 = require("../domain/UserInfo");
let PassportSerializerService = class PassportSerializerService {
    constructor(converterService) {
        this.converterService = converterService;
    }
    serialize(user, done) {
        try {
            const obj = this.converterService.serialize(user);
            // remove password from serialized object
            delete obj.password;
            done(null, JSON.stringify(obj));
        }
        catch (er) {
            done(er);
        }
    }
    deserialize(obj, done) {
        try {
            const user = this.converterService.deserialize(JSON.parse(obj), this.model);
            done(null, user);
        }
        catch (er) {
            done(er);
        }
    }
};
tslib_1.__decorate([
    di_1.Constant("passport.userInfoModel", UserInfo_1.UserInfo),
    tslib_1.__metadata("design:type", core_1.Type)
], PassportSerializerService.prototype, "model", void 0);
PassportSerializerService = tslib_1.__decorate([
    di_1.Service(),
    tslib_1.__metadata("design:paramtypes", [common_1.ConverterService])
], PassportSerializerService);
exports.PassportSerializerService = PassportSerializerService;
//# sourceMappingURL=PassportSerializerService.js.map