"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PlatformExpressHandler = void 0;
const common_1 = require("@tsed/common");
/**
 * @platform
 * @express
 */
class PlatformExpressHandler extends common_1.PlatformHandler {
    createRawHandler(metadata) {
        switch (metadata.type) {
            default:
                return super.createRawHandler(metadata);
            case common_1.HandlerType.CTX_FN:
                return async (req, res, next) => {
                    await this.onCtxRequest({
                        metadata,
                        next,
                        $ctx: req.$ctx
                    });
                };
            case common_1.HandlerType.ERR_MIDDLEWARE:
                return (err, request, response, next) => this.onRequest({
                    err,
                    $ctx: request.$ctx,
                    next,
                    metadata
                });
        }
    }
    async onCtxRequest(requestOptions) {
        try {
            return await super.onCtxRequest(requestOptions);
        }
        catch (er) {
            return this.onError(er, requestOptions);
        }
    }
}
exports.PlatformExpressHandler = PlatformExpressHandler;
//# sourceMappingURL=PlatformExpressHandler.js.map