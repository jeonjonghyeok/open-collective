{"version":3,"file":"PlatformExpressHandler.js","sourceRoot":"","sources":["../../src/services/PlatformExpressHandler.ts"],"names":[],"mappings":";;;AAAA,yCAA6F;AAE7F;;;GAGG;AACH,MAAa,sBAAuB,SAAQ,wBAAe;IAC/C,gBAAgB,CAAC,QAAyB;QAClD,QAAQ,QAAQ,CAAC,IAAI,EAAE;YACrB;gBACE,OAAO,KAAK,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC;YAE1C,KAAK,oBAAW,CAAC,MAAM;gBACrB,OAAO,KAAK,EAAE,GAAQ,EAAE,GAAQ,EAAE,IAAS,EAAE,EAAE;oBAC7C,MAAM,IAAI,CAAC,YAAY,CAAC;wBACtB,QAAQ;wBACR,IAAI;wBACJ,IAAI,EAAE,GAAG,CAAC,IAAI;qBACf,CAAC,CAAC;gBACL,CAAC,CAAC;YAEJ,KAAK,oBAAW,CAAC,cAAc;gBAC7B,OAAO,CAAC,GAAQ,EAAE,OAAY,EAAE,QAAa,EAAE,IAAS,EAAE,EAAE,CAC1D,IAAI,CAAC,SAAS,CAAC;oBACb,GAAG;oBACH,IAAI,EAAE,OAAO,CAAC,IAAI;oBAClB,IAAI;oBACJ,QAAQ;iBACT,CAAC,CAAC;SACR;IACH,CAAC;IAES,KAAK,CAAC,YAAY,CAAC,cAAgC;QAC3D,IAAI;YACF,OAAO,MAAM,KAAK,CAAC,YAAY,CAAC,cAAc,CAAC,CAAC;SACjD;QAAC,OAAO,EAAE,EAAE;YACX,OAAO,IAAI,CAAC,OAAO,CAAC,EAAE,EAAE,cAAc,CAAC,CAAC;SACzC;IACH,CAAC;CACF;AAjCD,wDAiCC","sourcesContent":["import {HandlerMetadata, HandlerType, OnRequestOptions, PlatformHandler} from \"@tsed/common\";\n\n/**\n * @platform\n * @express\n */\nexport class PlatformExpressHandler extends PlatformHandler {\n  protected createRawHandler(metadata: HandlerMetadata): Function {\n    switch (metadata.type) {\n      default:\n        return super.createRawHandler(metadata);\n\n      case HandlerType.CTX_FN:\n        return async (req: any, res: any, next: any) => {\n          await this.onCtxRequest({\n            metadata,\n            next,\n            $ctx: req.$ctx\n          });\n        };\n\n      case HandlerType.ERR_MIDDLEWARE:\n        return (err: any, request: any, response: any, next: any) =>\n          this.onRequest({\n            err,\n            $ctx: request.$ctx,\n            next,\n            metadata\n          });\n    }\n  }\n\n  protected async onCtxRequest(requestOptions: OnRequestOptions): Promise<any> {\n    try {\n      return await super.onCtxRequest(requestOptions);\n    } catch (er) {\n      return this.onError(er, requestOptions);\n    }\n  }\n}\n"]}