"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.importProviders = void 0;
const ProviderType_1 = require("../interfaces/ProviderType");
const GlobalProviders_1 = require("../registries/GlobalProviders");
const importComponents_1 = require("./importComponents");
const concatProviders = (results) => {
    return [].concat(...results);
};
async function recursiveImports(providers, settings, properties) {
    const { exclude = [] } = settings;
    const promises = providers
        .map(({ token }) => GlobalProviders_1.GlobalProviders.get(token))
        .filter((provider) => (provider === null || provider === void 0 ? void 0 : provider.type) === ProviderType_1.ProviderType.MODULE && provider.configuration)
        .map((provider) => importProviders({ exclude, ...provider.configuration }, properties));
    return concatProviders(await Promise.all(promises));
}
/**
 * Import providers from given patterns.
 *
 * @param settings
 * @param properties
 */
async function importProviders(settings, properties = ["imports"]) {
    const { exclude = [] } = settings;
    const promises = properties.map((key) => importComponents_1.importComponents(settings[key], exclude));
    const providers = concatProviders(await Promise.all(promises));
    const children = await recursiveImports(providers, settings, properties);
    return [...children, ...providers];
}
exports.importProviders = importProviders;
//# sourceMappingURL=importProviders.js.map