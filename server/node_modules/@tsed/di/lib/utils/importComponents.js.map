{"version":3,"file":"importComponents.js","sourceRoot":"","sources":["../../src/utils/importComponents.ts"],"names":[],"mappings":";;;AAAA,qCAA4C;AAE5C,+CAA0C;AAE1C,KAAK,UAAU,cAAc,CAAC,IAAS,EAAE,QAAkB;IACzD,IAAI,cAAO,CAAC,IAAI,CAAC,EAAE;QACjB,OAAO,CAAC,IAAI,CAAC,CAAC;KACf;IACD,0BAA0B;IAC1B,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,EAAE;QACxB,OAAO,yBAAW,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;KACpC;IAED,0BAA0B;IAC1B,OAAO,EAAE,CAAC;AACZ,CAAC;AAED,SAAgB,gBAAgB,CAAC,MAAW;IAC1C,IAAI,cAAO,CAAC,MAAM,CAAC,EAAE;QACnB,OAAO,MAAM,CAAC,GAAG,CAAC,CAAC,KAAU,EAAE,EAAE;YAC/B,OAAO;gBACL,MAAM,EAAE,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC;aACzB,CAAC;QACJ,CAAC,CAAC,CAAC;KACJ;IAED,OAAO,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,CAAC,IAAW,EAAE,GAAW,EAAE,EAAE;QAC7D,IAAI,CAAC,IAAI,CAAC;YACR,QAAQ,EAAE,GAAG;YACb,MAAM,EAAE,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;SAC/B,CAAC,CAAC;QAEH,OAAO,IAAI,CAAC;IACd,CAAC,EAAE,EAAE,CAAC,CAAC;AACT,CAAC;AAjBD,4CAiBC;AAEM,KAAK,UAAU,gBAAgB,CAAC,MAAW,EAAE,QAAkB;IACpE,IAAI,CAAC,MAAM,EAAE;QACX,OAAO,EAAE,CAAC;KACX;IAED,MAAM,GAAG,gBAAgB,CAAC,MAAM,CAAC,CAAC;IAElC,MAAM,QAAQ,GAAQ,EAAE,CAAC;IACzB,KAAK,MAAM,MAAM,IAAI,MAAM,EAAE;QAC3B,QAAQ,CAAC,IAAI,CACX,GAAG,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,EAAE,KAAU,EAAE,EAAE;YACxC,MAAM,OAAO,GAAG,MAAM,cAAc,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;YAEtD,OAAO,OAAO;iBACX,MAAM,CAAC,CAAC,MAAM,EAAE,EAAE,CAAC,cAAO,CAAC,MAAM,CAAC,CAAC;iBACnC,GAAG,CAAC,CAAC,MAAM,EAAE,EAAE;gBACd,MAAM,QAAQ,GAA4B,EAAC,KAAK,EAAE,MAAM,EAAE,KAAK,EAAE,MAAM,CAAC,QAAQ,EAAC,CAAC;gBAElF,OAAO,QAAQ,CAAC;YAClB,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CACH,CAAC;KACH;IAED,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;IAE3C,OAAQ,EAAU,CAAC,MAAM,CAAC,GAAG,MAAM,CAAC,CAAC;AACvC,CAAC;AA3BD,4CA2BC","sourcesContent":["import {isArray, isClass} from \"@tsed/core\";\nimport {IProvider} from \"../interfaces/IProvider\";\nimport {importFiles} from \"./importFiles\";\n\nasync function resolveSymbols(item: any, excludes: string[]) {\n  if (isClass(item)) {\n    return [item];\n  }\n  /* istanbul ignore else */\n  if (!process.env.WEBPACK) {\n    return importFiles(item, excludes);\n  }\n\n  /* istanbul ignore next */\n  return [];\n}\n\nexport function mapConfiguration(config: any): {endpoint?: string; values: any[]}[] {\n  if (isArray(config)) {\n    return config.map((value: any) => {\n      return {\n        values: [].concat(value)\n      };\n    });\n  }\n\n  return Object.keys(config).reduce((list: any[], key: string) => {\n    list.push({\n      endpoint: key,\n      values: [].concat(config[key])\n    });\n\n    return list;\n  }, []);\n}\n\nexport async function importComponents(config: any, excludes: string[]): Promise<Partial<IProvider<any>>[]> {\n  if (!config) {\n    return [];\n  }\n\n  config = mapConfiguration(config);\n\n  const promises: any = [];\n  for (const option of config) {\n    promises.push(\n      ...option.values.map(async (value: any) => {\n        const symbols = await resolveSymbols(value, excludes);\n\n        return symbols\n          .filter((symbol) => isClass(symbol))\n          .map((symbol) => {\n            const provider: Partial<IProvider<any>> = {token: symbol, route: option.endpoint};\n\n            return provider;\n          });\n      })\n    );\n  }\n\n  const result = await Promise.all(promises);\n\n  return ([] as any).concat(...result);\n}\n"]}