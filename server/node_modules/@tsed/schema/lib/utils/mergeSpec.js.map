{"version":3,"file":"mergeSpec.js","sourceRoot":"","sources":["../../src/utils/mergeSpec.ts"],"names":[],"mappings":"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","sourcesContent":["import {cleanObject, deepExtends} from \"@tsed/core\";\nimport {OpenSpec2, OpenSpec3} from \"@tsed/openspec\";\n\n/**\n * @ignore\n */\nexport const defaultReducer = (collection: any[], value: any) => {\n  if (collection.indexOf(value) === -1) {\n    collection.push(value);\n  }\n\n  return collection;\n};\n\n/**\n * @ignore\n */\nexport const schemesReducer = (collection: any[], value: any) => {\n  const current = collection.find((current) => current.type === value.type);\n\n  if (current) {\n    deepExtends(current, value);\n  } else {\n    collection.push(value);\n  }\n\n  return collection;\n};\n\n/**\n * @ignore\n */\nexport const parameters = (collection: any[], value: any) => {\n  const current = collection.find((current) => current.in === value.in && current.name === value.name);\n\n  if (current) {\n    deepExtends(current, value);\n  } else {\n    collection.push(value);\n  }\n\n  return collection;\n};\n\n/**\n * @ignore\n */\nexport const security = (collection: any[], value: any) => {\n  const current = collection.find((current: any): any => {\n    return Object.keys(value).find((key) => !!current[key]);\n  });\n\n  if (current) {\n    deepExtends(current, value, {default: defaultReducer});\n  } else {\n    collection.push(value);\n  }\n\n  return collection;\n};\n\n/**\n * @ignore\n */\nexport const tagsReducer = (collection: any[], value: any) => {\n  const current = collection.find((current) => current.name === value.name);\n\n  if (current) {\n    deepExtends(current, value);\n  } else {\n    collection.push(value);\n  }\n\n  return collection;\n};\n\n/**\n * @ignore\n */\nconst SPEC_REDUCERS = {\n  default: defaultReducer,\n  security,\n  parameters,\n  oneOf: schemesReducer,\n  anyOf: schemesReducer,\n  allOf: schemesReducer,\n  tags: tagsReducer\n};\n\n/**\n * Merge two spec\n * @param spec\n * @param input\n */\nexport function mergeSpec<Spec = OpenSpec2 | OpenSpec3>(spec: Partial<Spec>, input: Partial<Spec>): Partial<Spec> {\n  return cleanObject(deepExtends(spec, input, SPEC_REDUCERS));\n}\n"]}